apiVersion: policy.open-cluster-management.io/v1
kind: Policy
metadata:
  name: {{name}}
  namespace: {{namespace}}
  annotations:
    policy.open-cluster-management.io/standards: {{#each templates}}{{replacements.standards}}{{/each}}
    policy.open-cluster-management.io/categories: {{#each templates}}{{replacements.categories}}{{/each}}
    policy.open-cluster-management.io/controls: {{#each templates}}{{replacements.controls}}{{/each}}
spec:
  remediationAction: {{remediation}}
  disabled: {{disabled}}
  {{#if policyTemplate}}
  policy-templates:
  {{policyTemplate.replacements.policyTemplates}}
  {{/if}}
{{#if clusters.length}}
---
apiVersion: apps.open-cluster-management.io/v1
kind: PlacementRule
metadata:
  name: placement-{{name}}
  namespace: {{namespace}}
spec:
  clusterConditions:
  - status: "True"
    type: ManagedClusterConditionAvailable
  clusterSelector:
    matchExpressions:
      {{#each clusters}}
      - {key: {{@key}}, operator: In, values: [{{#each this}}{{#if @index}}, {{/if}}"{{this}}"{{/each}}]}
      {{else}}
      []  # selects all clusters if not specified
      {{/each}}
---
apiVersion: policy.open-cluster-management.io/v1
kind: PlacementBinding
metadata:
  name: binding-{{name}}
  namespace: {{namespace}}
placementRef:
  name: placement-{{name}}
  kind: PlacementRule
  apiGroup: apps.open-cluster-management.io
subjects:
- name: {{name}}
  kind: Policy
  apiGroup: policy.open-cluster-management.io
{{/if}}
